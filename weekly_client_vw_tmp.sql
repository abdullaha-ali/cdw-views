CREATE ALGORITHM=UNDEFINED DEFINER=`hdfs`@`%` SQL SECURITY DEFINER VIEW `weekly_client_vw_tmp` AS select `cdd`.`date` AS `date`,(case when ((`cdd`.`creativename` like 'Tracking%') or (`cdd`.`creativename` like '%Default%')) then ucase(`cdd`.`packageidcm`) else ucase(`cdd`.`crpackageid`) end) AS `Package_Code`,`cdd`.`cradunitid` AS `Ad_Unit_ID_CDW`,(case when (`tactic_match_key`.`ad_unit_type` is not null) then `tactic_match_key`.`ad_unit_type` else `b`.`ActivityType` end) AS `Ad_Unit_Type`,(case when (`smk`.`standardized_site` is not null) then `smk`.`standardized_site` else `cdd`.`sitename` end) AS `media_partner`,`cdd`.`click_through_url` AS `click_through_url`,(case when (`cbmv`.`activity` <> `back`.`activity`) then 0 when (ucase(`cdd`.`cost_method`) = 'DCPM') then `cdd`.`net_cost` when ((`cdd`.`cost_method` = 'CPC') and (`cdd`.`clicks` = 0)) then 0 when (`cdd`.`cost_method` = 'CPC') then ((`cdd`.`clicks` / `dp`.`clicks`) * `dp`.`today_cost`) when (`dp`.`package_roadblock_id` = 126861147) then `dp`.`today_cost` else ((`cdd`.`impressions` / `dp`.`impressions`) * `dp`.`today_cost`) end) AS `Cost`,(case when (`cbmv`.`activity` <> `back`.`activity`) then 0 when (ucase(`cdd`.`cost_method`) = 'DCPM') then `cdd`.`net_cost` when ((`cdd`.`cost_method` = 'CPC') and (`cdd`.`clicks` = 0)) then 0 when (`cdd`.`cost_method` = 'CPC') then ((`cdd`.`clicks` / `dp`.`clicks`) * `dp`.`today_cost`) when (`dp`.`package_roadblock_id` = 126861147) then `dp`.`today_cost` else ((`cdd`.`impressions` / `dp`.`impressions`) * `dp`.`today_cost`) end) AS `Projected_Cost`,`cdd`.`cost_method` AS `Media_Buy_Method`,(case when ((`cbmv`.`activity` = `back`.`activity`) or isnull(`cbmv`.`activity`)) then `cdd`.`impressions` else 0 end) AS `impressions`,(case when ((`cbmv`.`activity` = `back`.`activity`) or isnull(`cbmv`.`activity`)) then `cdd`.`clicks` else 0 end) AS `clicks`,coalesce(`back`.`total_conversions`,0) AS `visits`,(case when ((lcase(`b`.`ActivityType`) like '%Video%') or (lcase(`tactic_match_key`.`ad_unit_type`) like '%Video%')) then (case when ((`cbmv`.`activity` = `back`.`activity`) or isnull(`cbmv`.`activity`)) then `cdd`.`impressions` else 0 end) else 0 end) AS `Video_Starts`,((case when ((`cbmv`.`activity` = `back`.`activity`) or isnull(`cbmv`.`activity`)) then `cdd`.`videocompletions50` else 0 end) + (case when ((`cbmv`.`activity` = `back`.`activity`) or isnull(`cbmv`.`activity`)) then `cdd`.`videocompletions50_dcm` else 0 end)) AS `Total_VideoCompletes_50`,((case when ((`cbmv`.`activity` = `back`.`activity`) or isnull(`cbmv`.`activity`)) then `cdd`.`videocompletions100` else 0 end) + (case when ((`cbmv`.`activity` = `back`.`activity`) or isnull(`cbmv`.`activity`)) then `cdd`.`videocompletions100_dcm` else 0 end)) AS `Total_Video_Completions`,(case when ((`cbmv`.`activity` = `back`.`activity`) or isnull(`cbmv`.`activity`)) then `cdd`.`totalengagements` else 0 end) AS `Content_Engagements`,(coalesce((case when ((`cbmv`.`activity` = `back`.`activity`) or isnull(`cbmv`.`activity`)) then `cdd`.`ordervol` else 0 end),0) * 1) AS `attributed_orders_(24-hr)`,(coalesce((case when ((`cbmv`.`activity` = `back`.`activity`) or isnull(`cbmv`.`activity`)) then `cdd`.`salesvol` else 0 end),0) * 1) AS `attributed_revenue_(24-hr)`,`cdd`.`placement` AS `placement_name`,`cdd`.`placement_id` AS `placement_id`,`cdd`.`creativename` AS `creative_name`,`cdd`.`creativeid` AS `creative_id` from ((((((((`custom_display_data_internal` `cdd` left join `perception_backend_vw` `back` on(((`cdd`.`date` = `back`.`date`) and (`cdd`.`placement_id` = `back`.`placement_id`) and (`cdd`.`adid` = `back`.`ad_id`) and (`cdd`.`creativeid` = `back`.`creative_id`) and (`cdd`.`dynamic_element_value` = (case when (`back`.`dynamic_element_1_value` = '') then 'NA' else `back`.`dynamic_element_1_value` end))))) left join `dashcampaign_matchkey_data` `dash` on((trim(lcase(`cdd`.`campaignname`)) = trim(lcase(`dash`.`campaign`))))) left join `activity_lookup_matchkey` `b` on((ucase(trim(`cdd`.`crcreativetype`)) = ucase(trim(`b`.`crCreativeType`))))) left join `perception_backend_max_vw` `cbmv` on(((`cdd`.`date` = `cbmv`.`date`) and (`cdd`.`placement_id` = `cbmv`.`placement_id`) and (`cdd`.`adid` = `cbmv`.`ad_id`) and (`cdd`.`creativeid` = `cbmv`.`creative_id`) and (`cdd`.`dynamic_element_value` = (case when (`cbmv`.`dynamic_element_1_value` = '') then 'NA' else `cbmv`.`dynamic_element_1_value` end))))) left join `Program_cdw_mapping_vw` `pcm` on((trim(`pcm`.`campaign_name`) = trim(`cdd`.`campaignname`)))) left join `site_match_key` `smk` on((ucase(trim(`cdd`.`sitename`)) = ucase(trim(`smk`.`site`))))) left join `display_pacing` `dp` on(((`cdd`.`placementgroupid` = `dp`.`package_roadblock_id`) and (`cdd`.`placement_id` = `dp`.`placement_id`) and (`cdd`.`creativeid` = `dp`.`creative_id`) and (`cdd`.`date` = `dp`.`date`)))) left join `tactic_match_key` on((`cdd`.`tactic` = `tactic_match_key`.`tactic`))) where ((`cdd`.`date` <> '0000-00-00') and (`cdd`.`campaignname` like '%2018%'))